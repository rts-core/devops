- name: Install K8s
  hosts: 'k8scontrollers, k8sworkers'
  remote_user: kube
  become: true
  become_method: sudo
  tasks:
   - name: Add K8s Repo and exclude kube apps from update
     ansible.builtin.copy:
      dest: '/etc/yum.repos.d/kubernetes.repo'
      content: |
          [kubernetes]
          name=Kubernetes
          baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64
          enabled=1
          gpgcheck=1
          gpgkey=https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg
          exclude=kubelet kubeadm kubectl
      mode: '0644'
     changed_when: true

   - name: Install K8s
     ansible.builtin.yum:
      name:
       - kubelet-1.26.2-0
       - kubeadm-1.26.2-0
       - kubectl-1.26.2-0
      disable_excludes: all
      state: present
   - name: Enable Kubelet service
     ansible.builtin.systemd:
      name: kubelet
      enabled: true
      state: started
